<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Graph 3-Coloring App - Hosted on GitHub Pages" />
  <title>Graph 3-Coloring App</title>

  <!-- Styles -->
  <link rel="stylesheet" href="style.css" />

  <!-- Python Execution -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>
</head>

<body>
    <main class="container">
    <header class="mb-4 text-center">
      <h1 id="app-name">Graph 3-Coloring App</h1>
      <p id="app-description">Developed by Lucie Della-Negra as project-based learning</p>
    </header>
    

    <section class="card">
        <h2>Try coloring your own graph !</h2>
        <p>
            For the moment, you can only show the graph you selected through its edges.
        </p>
        
        <!-- Inputs -->
        <label>Note the edges that define your graph:</label><br>
        <textarea id="edgesInput">[('A','B'),('A','C'),('A','D'),('B','C'),('B','D')]</textarea>
        </br>
        <button id="plotBtn" class="button" onclick="updateGraph()" disabled="disabled">Show corresponding graph</button>

        <div id="output" class="graph-output d-flex flex-column">
            <div id="loader" class="loader-inline">
                <div class="spinner"></div>
                <span class="loader-text">Loading Python environment, please wait...</span>
            </div>
        </div>
    </section>

    <footer class="mt-4 text-center">
      <p>
        Â© <span id="year"></span> 
        <span id="author-name">Lucie Della-Negra</span>
      </p>
    </footer>

  <script>
    let pyodide = null;
    
    // Set current year
    document.getElementById("year").textContent = new Date().getFullYear();

    // Import python environmnent - Used when window is loading
    async function initPyodide() {
        pyodide = await loadPyodide({
            stdout: (text) => console.log(text),
            stderr: (text) => console.error(text)
        });

        // Preload Python packages ONCE
        await pyodide.loadPackage(["matplotlib", "networkx"]);
        
        // Fetch and inject config in Python
        const response = await fetch("./config.json");
        const config = await response.json();
        
        pyodide.globals.set("global_vars", pyodide.toPy(config));

        // Plot the first graph
        updateGraph.call()
        // Activate button once it is done
        .then(() => document.getElementById("plotBtn").disabled = false)   
    }
    
    // Run on page load
    window.addEventListener("DOMContentLoaded", initPyodide);

    // Python execution - Plot uncolored graph with user inputs
    async function updateGraph() {
      
      // Get user inputs as raw strings
      const edgesStr = document.getElementById("edgesInput").value;

      // Inject inputs into Python
      pyodide.globals.set("edges_str", edgesStr);
      
      // Run python code that plots current graph
      pyodide.runPython(await (await fetch("plot_graph.py")).text());
    }
    
  </script>
</body>
</html>